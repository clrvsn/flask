{% extends "base.html" %}
{% block head %}
<style>
    table.tooltip th, table.tooltip td {
        vertical-align: top;
        padding: 3px;
    }
</style>
{% endblock %}
{% block content %}
<div class="main">
  <h1 class="page-header">Initiatives by Programme</h1>
    <table>
        <tr>
            <td valign="top">
                <h3>Initiatives clustered by the Programme they belong to</h3>
                <div id="diagram"></div>
                <br/>
                <h3>Legend</h3>
                <img src="/static/img/byprog.legend.svg">
            </td>
            <td valign="top">
                <h3>Filters</h3>
                <h4>Status</h4>
                <div id="state-filter"></div>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('state',true)">All</button>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('state',false)">None</button>

                <h4>Category</h4>
                <div id="category-filter"></div>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('category',true)">All</button>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('category',false)">None</button>

                <h4>Programme</h4>
                <div id="prog-filter"></div>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('program_id',true)">All</button>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('program_id',false)">None</button>

                <h4>IWOW Process</h4>
                <div id="proc-filter"></div>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('process_id',true)">All</button>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('process_id',false)">None</button>

                <h4>Tracker Frequency</h4>
                <div id="tracker-filter"></div>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('tracker_freq',true)">All</button>
                <button type="button" class="btn btn-default btn-xs" onclick="set_all_filters('tracker_freq',false)">None</button>
            </td>
        </tr>
    </table>

    <div id="tooltip" class="hidden">
        <table class="tooltip">
            <tr><th>Status:</th> <td id="tt_stat"></td></tr>
            <tr><th>Type:</th> <td id="tt_type"></td></tr>
            <tr><th>Category:</th> <td id="tt_cat"></td></tr>
            <tr><th>Programme:</th> <td id="tt_prog"></td></tr>
            <tr><th>Function:</th> <td id="tt_func"></td></tr>
            <tr><th>Start:</th> <td id="tt_start"></td></tr>
            <tr><th>End:</th> <td id="tt_end"></td></tr>
        </table>
    </div>
</div>
{% endblock %}
{% block foot %}
    <script type="text/javascript" src="/static/js/byprog.js"></script>
    <script type="text/javascript">

        d3.json("/data/byprog", function(byprog_data) {
            set_data(byprog_data);

            mk_filter('INI', 'state', 'state-filter', ['pending','started','rollout','closed']);
            mk_filter('INI', 'category', 'category-filter');
            mk_filter('INI', 'program_id', 'prog-filter');
            mk_filter('INI', 'process_id', 'proc-filter');
            mk_filter('INI', 'tracker_freq', 'tracker-filter');

            mk_index('ini', data.inits);

            data.inits.forEach(function(ini) {
                ini.lines = [];
            });

            data.programme.forEach(function(prog) {
                var rows = num(prog.byprog_row) + num(prog.byprog_rows),
                    cols = num(prog.byprog_col) + num(prog.byprog_cols);
                init_grid.rows = Math.max(init_grid.rows, rows);
                init_grid.cols = Math.max(init_grid.cols, cols);
            });
            w = init_grid.cols * init_grid.colw + 20;
            h = init_grid.rows * init_grid.rowh + init_grid.rowh/2;

            render();
        });

    </script>
{% endblock %}
